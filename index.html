<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, box-sizing: border-box;">
    <title>Tampilkan Data Penduduk dengan Pagination dan Pencarian</title>
    
    <style>
        /* CSS dari kode sebelumnya */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
			padding: 0;
            background-color: #ecf0f1;
            font-size: 1vw;
            box-sizing: border-box;
        }

		*, *::before, *::after {
			box-sizing: inherit;
		}
		
		
		
		
        header {
            background-color: #1c2d3d;
            color: white;
            padding: 13px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: fixed;
			 min-height: 100px;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        .header-left, .header-center, .header-right {
            display: flex;
            align-items: center;
        }
        .header-left {
            flex: 1;
			
		header, main {
    padding-left: 20px;
    padding-right: 20px;
    box-sizing: border-box;
}	
		
		
        }
        .header-left button {
            background-color: #e74c3c;
            color: white;
            border: none;
            padding: 8px 12px;
            cursor: pointer;
            border-radius: 5px;
            margin-right: 15px;
            transition: background-color 0.3s;
        }
        .header-left button:hover {
            background-color: #c0392b;
        }
        .header-left h2 {
            color: #a8a8a8;
            font-size: 1.5rem;
            margin: 0;
            margin-left: 10px;
        }
		

.header-center {
    flex: 2;
    justify-content: center;
    margin-right: 100px;
}

.header-center select,
.header-center input,
.header-center button {
    max-width: 100%;
}
        .header-center select, .header-center input {
            padding: 8px;
            margin-right: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 1rem;
        }
        .header-center button {
            background: linear-gradient(90deg, #E83F25, #EA7300);
            color: white;
            border: none;
            padding: 10px 15px;
            cursor: pointer;
            border-radius: 5px;
            font-weight: bold;
            margin-left: 15px;
            transition: background 0.3s ease, transform 0.2s ease;
        }
        .header-center button:hover {
            background: linear-gradient(90deg, #e66b50, #e89f6a);
            transform: scale(1.05);
        }
        .header-right {
            flex: 1;
            justify-content: flex-end;
        }
        .header-right button {
            background-color: #2ecc71;
            color: white;
            border: none;
            padding: 10px 12px;
            cursor: pointer;
            border-radius: 5px;
            font-size: 1.2rem;
            transition: background-color 0.3s;
            margin-left: 10px;
        }
        .header-right button:hover {
            background-color: #27ae60;
        }
        main {
			padding: 0;
            width: 100%;
            margin-top: 93px;
            padding: 10px;
			width: 100vw;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
			 table-layout: auto;
			 margin: 3;
			 width: 101.78%; /* atau 110%, sesuai selera */
			 margin-left: -1%;
        }
		
		.container {
    padding: 0 !important;
    margin: 0 !important;
}
        table, th, td {
            border: 1px solid #ddd;
        }
        th, td {
            padding: 8px;
            text-align: center;
        }
        th {
            background-color: #23374a;
            color: white;
			height: 40px;
        }
        /* Sembunyikan kolom Aksi */
        th:nth-child(12), td:nth-child(12) {
            display: none;
        }
		
		/* Kolom KK (kolom ke-2) */
		th:nth-child(2), td:nth-child(2) {
		width: 140px; /* bisa juga 120px atau lebih kecil */
		word-break: break-all;
		}

		/* Kolom NIK (kolom ke-3) */
		th:nth-child(3), td:nth-child(3) {
		width: 140px; /* sesuaikan dengan tampilan, bisa diperkecil lagi */
		word-break: break-all;
		}

		th:nth-child(4), td:nth-child(4) {
		width: 220px; /* bisa sesuaikan, misalnya 250px */
			}
		td:nth-child(4) {
		text-align: left;
		padding-left: 10px;
		}
		
		/* Kolom Pekerjaan */
		td:nth-child(9) {
		text-align: left;
		padding-left: 10px;
		}

		/* Kolom Alamat Dusun */
		td:nth-child(10) {
		text-align: left;
		padding-left: 10px;
		}


table tbody td {
    text-transform: none;
}

        table tbody tr:hover {
            background-color: #ebe8d5;
            cursor: pointer;
            transition: transform 0.2s ease-in-out, background-color 0.2s ease-in-out;
        }
        table tbody tr.selected {
            background-color: #ebd0ae;
            color: #131010;
            transition: background-color 0.3s ease-in-out;
			
        }
        .pagination {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .pagination button {
            margin: 0 5px;
            padding: 5px 10px;
            cursor: pointer;
        }
		
		
        #progress {

		position: fixed;
        padding-left: 30;
		width: 100%;
        height: 8px;
		margin: 8px auto;
		z-index: 9999;
		top: 95px;             /* sesuaikan agar tidak menabrak header */
		left: 10;
        }
		

        #progress-bar {
            height: 100%;
            width: 0;
            background: linear-gradient(100deg, #FF5733, #FFC107);
            transition: width 0.3s ease-in-out;
            border-radius: 15px;
        }
		
		
		
		
		
        .form-popup {
			cursor: move;
			position: fixed;
            display: none;
            position: fixed;
            top: 45%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #f7f7f7;
            border: 1px solid #ccc;
            border-radius: 10px;
            box-shadow: 0 1px 10px rgba(0, 0, 0, 0.2);
            z-index: 1001;
            padding: 25px;
			padding-left: 65px;
			padding-right: 5px;
			padding-top: 9px;
            width: 350px;
            max-width: 30%;
        }
		
	
        .form-popup input[type="text"],
        .form-popup input[type="date"],
        .form-popup input[type="email"],
        .form-popup input[type="password"] {
            width: 85%;            /* semula 100%, jadi lebih ramping */
			padding: 5px 7px;      /* semula 10px, lebih kecil */
			margin-bottom: 4px;    /* semula 10px, jarak antar field lebih rapat */
            border: 1px solid #ccc;
            border-radius: 7px;
            box-sizing: border-box;
        }
        #btn-simpanPP {
            background: linear-gradient(90deg, #E83F25, #EA7300);
            color: white;
            border: none;
            padding: 10px 22px;
            cursor: pointer;
            border-radius: 5px;
            font-weight: bold;
            margin-left: 15px;
            transition: background 0.3s ease, transform 0.2s ease;
        }
		
        #btn-simpanPP:hover {
            background: linear-gradient(90deg, #e66b50, #e89f6a);
            transform: scale(1.05);
        }
        #btn-simpanPP:active {
            transform: scale(0.95);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }
        #btn-batalPP {
            background-color: #5e5e5e;
            color: #fff;
            padding: 8px 20px;
			margin-left: 13px;
            border: none;
            border-radius: 5px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s ease, background-color 0.3s ease, box-shadow 0.2s ease;
        }
        #btn-batalPP:hover {
            background-color: #4a4a4a;
            box-shadow: 0 6px 10px rgba(0, 0, 0, 0.2);
        }
        #btn-batalPP:active {
            transform: scale(0.95);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }
        .data-popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #ffffff;
            border: 1px solid #ccc;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            z-index: 1001;
            padding: 20px;
            width: 500px;
            max-width: 90%;
        }
        .data-popup table {
            width: 100%;
        }
        .data-popup th, .data-popup td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        @media (max-width: 768px) {
            .header-left, .header-center, .header-right {
                flex-direction: column;
                align-items: center;
            }
            .header-left, .header-right {
                margin-bottom: 10px;
            }
            header {
                flex-direction: column;
            }
 
            .header-center select, .header-center input {
                width: 90%;
            }
            table, th, td {
                font-size: 0.9em;
            }
        }
        #btn-back {
            margin-left: 10px;
        }
		
		
		
		
		
.toolbar {
    display: flex;
    justify-content: center;
    gap: 0px;
    margin-top: 10px;
}

.icon-wrapper {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
    margin: 0 12px; /* buat lebih longgar */
}


.icon sorrows {
    opacity: 0.6;
    transition: all 0.3s ease;
    transform: scale(icing);
    cursor: pointer;
}

.icon-wrapper img {
    opacity: 0.6;
    transition: all 0.3s ease;
    transform: scale(1);
    cursor: pointer;
}


.icon-wrapper img:hover {
    opacity: 0.8;
    transform: scale(1.1);
    filter: drop-shadow(0 2px 5px rgba(255, 255, 255, 0.3));
}

.icon-label {
    font-size: 11px;
    color: rgba(255, 255, 255, 0.7);
    text-align: center;
    line-height: 1;
    transition: color 0.3s ease;
}

.icon-wrapper img:hover + .icon-label {
    color: #595959;
}

.icon-wrapper .btn-delete {
    filter: grayscale(100%) brightness(0.8) sepia(1) hue-rotate(-50deg) saturate(5);
}

.icon-wrapper .ico2 {
    filter: grayscale(100%) brightness(0.8) sepia(1) hue-rotate(-50deg) saturate(5);
}

.icon-wrapper .btn-delete:hover {
    filter: none;
    opacity: 1;
    transform: scale(1.1);
    box-shadow: 0 0 5px 2px rgba(0, 0, 7, 0.8);
}

.icon-wrapper .ico2:hover {
    filter: none;
    opacity: 1;
    transform: scale(1.1);
    box-shadow: 0 0 5px 2px rgba(0, 0, 7, 0.8);
}

#btn-back {
    position: relative;
    margin-left: 40px; /* Ubah dari 0 ke 20px */
    padding: 5px;
    width: 35px;
    height: 35px;
    z-index: 2001;
    background-color: transparent;
    border: none;
    transition: transform 0.2s ease;
}

#btn-back:hover {
    transform: scale(1.1);
}


.icon:hover {
    opacity: 1.8;
}

.tekback {
    position: relative;
    left: -2px;
    right: 120px;
    top: -2px;
    font-size: 21px;
    font-weight: bold;
    justify-content: center;
    align-items: center;
}


.flatpickr-calendar {
    margin-left: 10px !important;
}


.strip-warna {
    height: 14px;
    background-color: #1a2938; /* Oranye */
    width: 100%;
    position: fixed;
    top: 100px; /* Sama dengan tinggi header */
    left: 0;
    z-index: 999;
}


.form-popup, .data-popup {
    position: fixed; /* sudah oke */
    z-index: 9999;   /* lebih tinggi dari progress */
}


.error-message {
    color: #ff4d4d;
    font-size: 0.75rem;
    margin-top: -3px;
    margin-bottom: 4px;
    display: block;
}

input.error {
    border: 1px solid #ff4d4d;
    background-color: #fff2f2;
}


#clear-search {
    display: none;
    position: absolute;
    right: 20px;
    top: 50%;
    transform: translateY(-50%);
    cursor: pointer;
    font-size: 13px;
    color: #aaa;
    transition: color 0.2s ease, transform 0.2s ease;
}

/* Saat hover di ‚úñÔ∏è */
#clear-search:hover {
    color: #ff5c5c; /* Merah muda saat hover */
    transform: translateY(-50%) scale(1.1); /* Membesar 10% tanpa bergeser */
}




    </style>
</head>
<body>

<!-- Loading kecil setelah simpan -->
<div id="mini-loading" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
background: rgba(0, 0, 0, 0.7); color: white; padding: 10px 20px; border-radius: 10px; font-weight: bold; z-index: 10000;">
  Menyimpan data...
</div>

<!-- Pesan sukses kecil -->
<div id="success-message" style="display:none; position:fixed; bottom:30px; left:50%; transform:translateX(-50%);
background: #2ecc71; color: white; padding: 10px 20px; border-radius: 8px; font-weight: bold; box-shadow: 0 0 10px rgba(0,0,0,0.3);
z-index: 10000;">
  Data berhasil disimpan!
</div>



<header>
    <div class="header-left">
        <img src="surat/1/back.png" id="btn-back" alt="Kembali" class="ico3" width="30" height="30" style="cursor: pointer" onclick="goBack('dasboard.html')">
        <h2>DATABASE</h2>
    </div>
    <div class="header-center">
        <select id="functionSelect" onchange="executeFunction()">
            <option value="">Pilih Gampong</option>
            <option value="ABEUK JALOH">ABEUK JALOH</option>
            <option value="ALUE BAYEU UTANG">ALUE BAYEU UTANG</option>
            <option value="ALUE BIE PUSONG">ALUE BIE PUSONG</option>
            <option value="ALUE BUYA">ALUE BUYA</option>
            <option value="ALUE BUYA PASI">ALUE BUYA PASI</option>
            <option value="ALUE KUTA">ALUE KUTA</option>
            <option value="BADA BARAT">BADA BARAT</option>
            <option value="BADA TIMU">BADA TIMU</option>
            <option value="BARAT LANYAN">BARAT LANYAN</option>
            <option value="BUGAK BLANG">BUGAK BLANG</option>
            <option value="BUGAK KRUENG">BUGAK KRUENG</option>
            <option value="BUGAK KRUENG MATE">BUGAK KRUENG MATE</option>
            <option value="BUGAK MESJID">BUGAK MESJID</option>
            <option value="BUGENG">BUGENG</option>
            <option value="GAMPONG MEULINTEUNG">GAMPONG MEULINTEUNG</option>
            <option value="GEUNDOT">GEUNDOT</option>
            <option value="JANGKA ALUE">JANGKA ALUE</option>
            <option value="JANGKA ALUE BIE">JANGKA ALUE BIE</option>
            <option value="JANGKA ALUE U">JANGKA ALUE U</option>
            <option value="JANGKA KEUTAPANG">JANGKA KEUTAPANG</option>
            <option value="JANGKA MESJID">JANGKA MESJID</option>
            <option value="KAMBUK">KAMBUK</option>
            <option value="KUALA CEURAPE">KUALA CEURAPE</option>
            <option value="LAMKUTA">LAMKUTA</option>
            <option value="LAMPOH RAYEUK">LAMPOH RAYEUK</option>
            <option value="LHOK BUGENG">LHOK BUGENG</option>
            <option value="LINGGONG">LINGGONG</option>
            <option value="LUENG">LUENG</option>
            <option value="MEUNASAH KRUENG">MEUNASAH KRUENG</option>
            <option value="PANTE PAKU">PANTE PAKU</option>
            <option value="PANTE PEUSANGAN">PANTE PEUSANGAN</option>
            <option value="PANTE RANUB">PANTE RANUB</option>
            <option value="PANTE SUKON">PANTE SUKON</option>
            <option value="PAYA BIENG">PAYA BIENG</option>
            <option value="PULO BLANG">PULO BLANG</option>
            <option value="PULO IBOH">PULO IBOH</option>
            <option value="PULO REUDEUP">PULO REUDEUP</option>
            <option value="PULO SEUNA">PULO SEUNA</option>
            <option value="PULO U">PULO U</option>
            <option value="PUNJOT">PUNJOT</option>
            <option value="PL. PN. MEUNASAH DUA">PL. PN. MEUNASAH DUA</option>
            <option value="RUSEB ARA">RUSEB ARA</option>
            <option value="RUSEB DAYAH">RUSEB DAYAH</option>
            <option value="TANJUNGAN">TANJUNGAN</option>
            <option value="TANOH ANOE">TANOH ANOE</option>
            <option value="ULEU CEUE">ULEU CEUE</option>
        </select>
        
		<div style="position: relative; display: inline-block;">
    <input type="text" id="search" placeholder="Cari nama..." style="padding-right: 30px;" />
    <span id="clear-search">‚úñÔ∏è</span>
</div>
		
        <button onclick="showSelectedData()">PROSESS</button>
    </div>
    <div class="header-right">

	<div class="icon-wrapper">
		<img src="surat/1/new.png" class="ico2"  alt="Tambah" width="30" height="30" onclick="toggleForm()">
        <div class="icon-label">Tambah</div>
		</div>
		
		<div class="icon-wrapper">
            <img src="surat/1/edit.png" class="ico2" alt="Edit" width="30" height="30" onclick="editSelectedData()">
            <div class="icon-label">Edit</div>
        </div>
        <div class="icon-wrapper">
            <img src="surat/1/delete.png" class="btn-delete" alt="Hapus" width="30" height="30" onclick="deleteSelectedData()">
            <div class="icon-label">Delete</div>
        </div>
    </div>
	
</header>
<div class="strip-warna"></div>

    <div id="progress">
        <div id="progress-bar"></div>
    </div>
	
<main>


	
		
    <table id="data-table">
        <thead>
            <tr>
                <th>KODE</th>
                <th>KK</th>
                <th>NIK</th>
                <th>NAMA</th>
                <th>TEMPAT LAHIR</th>
                <th>TGL LAHIR</th>
                <th>STATUS</th>
                <th>GENDER</th>
                <th>PEKERJAAN</th>
                <th>ALAMAT DUSUN</th>
                <th>DESA</th>
                <th>Aksi</th> <!-- Tetap ada, tapi disembunyikan -->
            </tr>
        </thead>
        <tbody id="data-body">
            <!-- Data akan ditambahkan di sini -->
        </tbody>
    </table>

    <div class="pagination" id="pagination">
        <button onclick="changePage('prev')">BACK</button>
        <span id="page-numbers"></span>
        <button onclick="changePage('next')">NEXT</button>
    </div>
</main>

<!-- Form Popup -->
<div class="form-popup" id="form-popup">
    <h3 id="popup-header">Entry Data PENDUDUK</h3>
    <input type="text" id="kk" placeholder="Nomor KK (16 digit)" required maxlength="16" />
	<span class="error-message" id="kk-error"></span>
    <input type="text" id="nik" placeholder="NIK (16 digit)" required maxlength="16" />
	<span class="error-message" id="nik-error"></span>
    <input type="text" id="nama" placeholder="Nama" required />
    <input type="text" id="tempatlahir" placeholder="Tempat Lahir" required />
    <input type="text" id="tgllahir" placeholder="DD/MM/YYYY" required />
	<span class="error-message" id="tgl-error"></span>
    <input type="text" id="status" placeholder="Status (P/S/B)" required />
	<span class="error-message" id="status-error"></span>
    <input type="text" id="jeniskelamin" placeholder="Jenis Kelamin (L/P)" required />
	<span class="error-message" id="gender-error"></span>
    <input type="text" id="pekerjaan" placeholder="Pekerjaan" required />
    <input type="text" id="alamatdusun" placeholder="Alamat Dusun" required />
    <input type="text" id="desa" placeholder="Desa" required readonly />
    <button id="btn-simpanPP" onclick="isEditMode ? updateData() : addData()">Simpan</button>
    <button id="btn-batalPP" onclick="toggleForm()">Tutup</button>
</div>

<!-- Popup untuk menampilkan data yang dipilih -->
<div class="data-popup" id="data-popup">
    <h3>Data Penduduk Terpilih</h3>
    <table>
        <tr>
            <th>Kode</th>
            <th>KK</th>
            <th>NIK</th>
            <th>Nama</th>
            <th>Tempat Lahir</th>
            <th>Tanggal Lahir</th>
            <th>Status</th>
            <th>Gender</th>
            <th>Pekerjaan</th>
            <th>Alamat Dusun</th>
            <th>Desa</th>
            <th>Aksi</th> <!-- Tetap ada, tapi disembunyikan -->
        </tr>
        <tbody id="selected-data-body">
            <!-- Data yang dipilih akan ditampilkan di sini -->
        </tbody>
    </table>
    <button onclick="closeDataPopup()">Tutup</button>
    <button onclick="continueToNextPage()">LANJUT</button>
</div>

<script>
    let isEditMode = false;
    let currentPage = 1;
    const rowsPerPage = 10;
    let data = [];
    let filteredData = [];
    let selectedRowData = null;





    // Alamat GAS untuk mengambil data
    function getDesaUrl(namaDesa) {
        const baseUrls = {
            "ABEUK JALOH": "https://script.google.com/macros/s/AKfycbwGOX0Nmo4v_iDrNQXuRbo-eDrGSLRV2aSkxvzXZKOxfMhErAMaU4jiUMeUX2RhQq8PTw/exec",
			"ALUE BAYEU UTANG": "https://script.google.com/macros/s/AKfycbxgpTD51j7Q0u4IRBJjjnwAS_iaaXZPgYjSUMPwqaDlz1e3EWtXpTPjoNZA7u8ZzJs/exec",
			"ALUE BIE PUSONG": "https://script.google.com/macros/s/AKfycbwg2wobqxLNA4uxM2iRVnrsH38NZTxXeVcNZQdzXDGbdAvggoWPcIMEIOb671HfdkHq/exec",
			"ALUE BUYA": "https://script.google.com/macros/s/AKfycbzdnXjatnJpr9ArJZLpHZjaitOlCd2V4IJL7-8xnDu5bT073Zv8EZ-KgQtSX2CHEVCI/exec",
			"ALUE BUYA PASI": "https://script.google.com/macros/s/AKfycbzhD5BDaOlyFDvExlLihoLMNeDpKlXVcdl4ZFUbyAuDenRp4OkV8EYbxDwRUBKHTaY/exec",
			"ALUE KUTA": "https://script.google.com/macros/s/AKfycbxo4u5jNB7KEKHHklRxQ_y20rHx06atHfANljkhguw7_yMnz-Tf79--ZdWAMDcHIgL4/exec",
			"BADA BARAT": "https://script.google.com/macros/s/AKfycbzet7CQfIyLop-FLBu8ujetM6DhRSxk1kXVYuXVLR0JhUF0k8aBTaOQaaw6Uj_4v3Js/exec",
			"BADA TIMU": "https://script.google.com/macros/s/AKfycbzzgqsaT7rJpk_caIzCTu--5bgMw586u_J2PuUsNPO769Z8NbTDntoOHrasZXqrQFLy/exec",
			"BARAT LANYAN": "https://script.google.com/macros/s/AKfycbx8iSes2ee1p3vkuyDnUIUrWEo6NrTdqgsZR2O1NlPHDTMi-UG1UuRO9Vcu-UQA170o/exec",
			"BUGAK BLANG": "https://script.google.com/macros/s/AKfycbzWxpiC-3AQ2388ks1P0mlwahBmNJjV-qE9AoMVFFB_F4Id9i9FxK8hoEJ_oa04prE9sg/exec",
			"BUGAK KRUENG": "https://script.google.com/macros/s/AKfycbz-bSBpsBVG6CzLmTiz3qH9DVDi8DYdX07ug6DOUV01XH_FpmFZJRNzEkphHICGn9wNyg/exec",
			"BUGAK KRUENG MATE": "https://script.google.com/macros/s/AKfycbxJIq-V0i2a7z1OASebI7X6NDa6hf7h4ZlV9G4y437gdl2UsIZT0dZ2qAde68BrFCTXGA/exec",
			"BUGAK MESJID": "https://script.google.com/macros/s/AKfycbz064ZyA7m7lS2kpXcTEF8lP4cHqehuAHFWYKqtjnDmPnm8yrqRhsjA-LrwMZJxFX9o/exec",
			"BUGENG": "https://script.google.com/macros/s/AKfycbz5qI5V6KuJgCXguZrFEwo1mt5ooJtLI5lzBP47ft-UxfX142JowvN62HPmYPryI6LZ/exec",
			"GAMPONG MEULINTEUNG": "https://script.google.com/macros/s/AKfycbyhaMjsoEi-upIR_2YI20vPPJIS3ZdjTkyWa2L7nFCupI0kiZEUUcrJtoDXT3Ne6VKFXQ/exec",
			"GEUNDOT": "https://script.google.com/macros/s/AKfycbziXcBi_COuCR1gN26IfCw5ByXDAW7RwB7hNzzxFeyOeRmP9_4GyKSDDNp1YzmSd3r2/exec",
			"JANGKA ALUE": "https://script.google.com/macros/s/AKfycbzB8pEPHtTIImxYu8vLBdhb0CmrL4HxAMEixk-b_o73SDu62GnLHbSsrp_kmbuE9ppg/exec",
			"JANGKA ALUE BIE": "https://script.google.com/macros/s/AKfycbwFHYxKSmdpuvOA2733Uql2lEg9WvL_Ochz25NVZS1rBqAMePTVrCnxTkq5MP_9nnJ9/exec",
			"JANGKA ALUE U": "https://script.google.com/macros/s/AKfycbwcSTF_yFZpuJJ99I3GOvhxC-7UwvGXJBZ0njZiHZjUu0Duxh5fHqs-KABQR5P-zGSL/exec",
			"JANGKA KEUTAPANG": "https://script.google.com/macros/s/AKfycbxJMkHfODEyDZS8i8dgYqsh_ABiD_b-55ql8QP-sWnqRMuxKC52dxAZ3gJhNBfrY5I/exec",
			"JANGKA MESJID": "https://script.google.com/macros/s/AKfycbxKotY6f7kzJc83QJbZnJlz8qmRxp4XEdcx-KIfLBVp4PrllVLh2RFybaO2lUSpcb71yQ/exec",
			"KAMBUK": "https://script.google.com/macros/s/AKfycbyc_IL8-5htXZJ5nLAO9_NaT0OTD-ikIegvRi8DytG2BYGsqW6bwJ8xSl239cdBRFUyAw/exec",
			"KUALA CEURAPE": "https://script.google.com/macros/s/AKfycbx0JgmoZed7A1IzJ-LFLcrzRNwIax6x6dCIN59ZSzTZMYU3xf_iKmoBoFTrR8x5XEQy/exec",
			"LAMKUTA": "https://script.google.com/macros/s/AKfycbx58Bkb5X8GSzk0yy9ThdO8uA1w1n6Kkf75J4DgwoYhMnATTK7upWpJgSyxZjHL4BGw/exec",
			"LAMPOH RAYEUK": "https://script.google.com/macros/s/AKfycbywh_0QKz2eyNt6C0ElOtid38ZhLNbbjmLZqv6A34oXE-3vV_G7SFV4nMwb_JwcOW2s/exec",
			"LHOK BUGENG": "https://script.google.com/macros/s/AKfycbzyQjz2ldCHc_VdtODKIB3pTLdnfCDImp2HjDbYDVrBxL0YEVvj-uCoVUrVUVhbLinS/exec",
			"LINGGONG": "https://script.google.com/macros/s/AKfycbxPNKlUubh3HWAouWoYl9kDWZ-Aj5iHRkSn3ySv_L3nvZQQSI6jG1ntR7V_S06LhOLJ/exec",
			"LUENG": "https://script.google.com/macros/s/AKfycbztRG2jtBfLp_OS4dBhnAn8zew6kiaAtZROmYcjjrJmSKdZrhi4_uDxfmcXPnXqIHmZ/exec",
			"MEUNASAH KRUENG": "https://script.google.com/macros/s/AKfycbylrWqQp7QH1YpPtC1-j4TSkcf114KB6HZSnli4r2a-zjB-MIS5VNQWCj_YKD0Yq3tn_g/exec",
			"PANTE PAKU": "https://script.google.com/macros/s/AKfycbxdPyLpKBQ5o544HZ7U5u9IWcNJ_EbB0QajKpdzISO1xH5hvyhjo1tp6rCAa-B2OW__/exec",
			"PANTE PEUSANGAN": "https://script.google.com/macros/s/AKfycbzeLmmpZZlICiK7kQkJm3QHFkot7ks0fi7Ir-3ME9nLjOfxv-RZTkuEQNzy-5X9j-13/exec",
			"PANTE RANUB": "https://script.google.com/macros/s/AKfycbydTrCEL6sbCLh6_nHciNgephaUqfUXDOvWZKgrIEWd_jIwOOeiDNHRe_UdHpnsEVbSKg/exec",
			"PANTE SUKON": "https://script.google.com/macros/s/AKfycbwGD5VaCfJR2SpA6CWCb_Fz8Mr1gbJtRRcdv1NhY3FUrwW3Fg3hD5u3g2f16XdBW437OA/exec",
			"PAYA BIENG": "https://script.google.com/macros/s/AKfycbzYTFscgYb3T5MM_9JbrgEsb7CDWy7RBWFMw5rIOgPtZ1FZ-C20ZuDTikP3RUzDZR6w/exec",
			"PULO BLANG": "https://script.google.com/macros/s/AKfycbyAvAhVWjsX6peQ8iejzg-vKf2ZYjOBUQIrWI6Ux4SV0XMujSSLAsPcYpegP1sR0z-O-Q/exec",
			"PULO IBOH": "https://script.google.com/macros/s/AKfycbxGlBTgt0yGhIZA-rB-qdwz_bpZn7PQRNPRQ-6cJaWbCkeFPeJ1jA-zH-GtCDV-bWo6dw/exec",
			"PULO REUDEUP": "https://script.google.com/macros/s/AKfycbxZE-cKC_CSNQ3F-tp9bOvZeZ2O2vaZmttGRz7syRISPHHTfNcNjZJPN-vJkkRwI19E5A/exec",
			"PULO SEUNA": "https://script.google.com/macros/s/AKfycbxrefFg5dD7HLnwnDYA4hgsJrmOelwLN3QPtyi0oufdPpnfiHZorL7jJXqdvuPPQ-UE/exec",
			"PULO U": "https://script.google.com/macros/s/AKfycbxNzDMQGN772DFDmXHOc3Z5H5XOYU2BkJRFxoLi6aum-NP21wdub6uY9fjf40GeNAhByg/exec",
			"PUNJOT": "https://script.google.com/macros/s/AKfycbyDLVu2txAXz9b0NOAjwxqaH3ruv6w_K4_tK3pv9UIrGjLrO8xvUvBH0-BU_2lt71NDpw/exec",
			"PL. PN. MEUNASAH DUA": "https://script.google.com/macros/s/AKfycby-bGVdLJ3JGF5KIO99yLqTSg__1EGvwMImnVL4im5qOR7UZRvv7Lw-m2PO7MsAmqWFRg/exec",
			"RUSEB ARA": "https://script.google.com/macros/s/AKfycbzkzqR1NhECU1NORr0-sh-4lstFECZYZiorXdQnYUiypEhjgnnx70z0rUuCl8Z3Czn2/exec",
			"RUSEB DAYAH": "https://script.google.com/macros/s/AKfycbx37WIAErhG_IjtLuyHHm4R9YZNfnjQK9mfphK6lXLa21TD9ZOn79jYC5jsUPmTyq3AIQ/exec",
			"TANJUNGAN": "https://script.google.com/macros/s/AKfycbyQ8A_x5l1aQeAYEH6tEDv8Xsp9wSra-yz9OvbklTPJvfuGdwako2hhazDqJg7hPWoZzA/exec",
			"TANOH ANOE": "https://script.google.com/macros/s/AKfycbx9a9P4DX_rWNyYmTLD-yTl_EAcLoWoE5pZhSj_4Rcltt_BY3CNmW7-16pdJhb9zKg/exec",
			"ULEU CEUE": "https://script.google.com/macros/s/AKfycbzuXF0UZcDlwPVG3CwcNa0HB_eLBAJRAP3Ih43fUlF45l8-NmEn9xBZRJO9VbFlg_5B9g/exec"
        };
        return baseUrls[namaDesa];
    }

    // Alamat GAS untuk CRUD (tambah, edit, hapus)
    const scriptURLs = {
        "ABEUK JALOH": "https://script.google.com/macros/s/AKfycbzcjuAdZMbYi0A8VmaV3qxTasbWINNwdmFDhS5Sc6pEdaG5xNZbLflAtiN4ytDzoYmK/exec",
		"ALUE BAYEU UTANG": "https://script.google.com/macros/s/AKfycbwc_fFbfKXJ-SSntnSD-C08iH07DbQCO4vvNlXbJhw3hYhSVGOIRRnn4LCTp0IroDU4/exec",
		"ALUE BIE PUSONG": "https://script.google.com/macros/s/AKfycbwUC1hfWe202fDV8tpsW3KAx2KBlBAPVM3IoOhBxuJ2TtIDKyUMMQtheBj1meZ-RGNL/exec",
		"ALUE BUYA": "https://script.google.com/macros/s/AKfycbyD3H2GOwQzdQv7RHpAa3SyvWPjhHv45BSpu5V5TRxOsbM9dWnHevzGE87PvUUoU2_Z/exec",
		"ALUE BUYA PASI": "https://script.google.com/macros/s/AKfycbxNp31yYY6r-aVWUD2RGscOI0yhpbGTdRVNpzWO6Pq-ZG7z4UHpZlVqRnj7eYWcHcs/exec",
		"ALUE KUTA": "https://script.google.com/macros/s/AKfycbzMQHFk6ky6Syo19XOX6hLmkzGDhqqZGl9aracOkuT-L-b1xKx2pIWH7iNyHUPHdq-g/exec",
		"BADA BARAT": "https://script.google.com/macros/s/AKfycbzPCn4gGHG2hvW2rOV-loHuia9WdJWFHxPeqxFcJ3UDRsHSjBNx1bYDAR8x_dGhFIql/exec",
		"BADA TIMU": "https://script.google.com/macros/s/AKfycbyfLfoXCZ7zdSygzJ6acpHPe5uykDoLQTtdNXSFz-z2ERY-H3wJcEzMIfrbEyJN1rqo/exec",
		"BARAT LANYAN": "https://script.google.com/macros/s/AKfycbxemPKEo226xnbrnymZlKN3R9GbSIZNzxb-KkSKqsggwhwfDhLQ1N8LwZogFkfiKPuM/exec",
		"BUGAK BLANG": "https://script.google.com/macros/s/AKfycbxvs1_X0-zaDD7-hI40zONRPDEiNbHY8K2vA6WIQhgP191c3yIKVgw31nyUdTDJ1AhdpA/exec",
		"BUGAK KRUENG": "https://script.google.com/macros/s/AKfycbypwCTM0KMxwh-vX6J91f_NcfdTglUNp-kAhg4ZZQqy6nmow42C2xLJNpHdJmF9qO_Zmg/exec",
		"BUGAK KRUENG MATE": "https://script.google.com/macros/s/AKfycbxaaZUD_PRZHkcTi3CAoHCBQ8ZbNHpBUqwexlI6ZhwmDjt6jpJ3gt5j1dqfCoiKvkim1Q/exec",
		"BUGAK MESJID": "https://script.google.com/macros/s/AKfycbzqx0tKpfD6vIY6kkhzPgXUB8NoTco2DG6S3jQ_-xAi2VxzQ2dgVzdytnzW_QQQtRJ9/exec",
		"BUGENG": "https://script.google.com/macros/s/AKfycbxZJJh49oSWGDuedXo1Al4zm6rk-OgepoZkIiKBNDV_yw6IB3lEPANEne6xkbP1ASpW/exec",
		"GAMPONG MEULINTEUNG": "https://script.google.com/macros/s/AKfycbz1syILtRs4sUlt9vTXWrixb-UU7uHmpCTx8Yfby8729Xhn8xwXgfvC-tKH3tYma71KJQ/exec",
		"GEUNDOT": "https://script.google.com/macros/s/AKfycbyD0W4EegjFROsSmvvBw8UWjJv8BkRGihm5IhFdtaa0Yq8Ep2TA4H7iC2hO2lNsew44/exec",
		"JANGKA ALUE": "https://script.google.com/macros/s/AKfycbxqbXVXFVD-0z_ylFPKX98U8_If-QFfiLidkfjO7HJz9exGHEU1oDOR3GyrjuMA4CD_/exec",
		"JANGKA ALUE BIE": "https://script.google.com/macros/s/AKfycbyVtfUo8gukelNhLp1R1bSJUMlA6CdJhlpK7gO721WzDxKv4TwSJw3WhkEejIzRR2mfOA/exec",
		"JANGKA ALUE U": "https://script.google.com/macros/s/AKfycbxE8MKmnF2iPDV12QuBNaO2LXITM9UfSxQNDn7PH9fqXvA4SjtbSwwX-yLDfsbzjvhr/exec",
		"JANGKA KEUTAPANG": "https://script.google.com/macros/s/AKfycbwA4SJXqnHBlTBzIOOP6MOesIb5zENUbBIkLvEKdluCuR1ggie6VHaZ_2MX1eIn2Jur/exec",
		"JANGKA MESJID": "https://script.google.com/macros/s/AKfycbwAvilS6cTvkTarDTH-Bo4eV8S0iV-Zd1eHfOOenQXqyxWXSqWRY4aDR5FxH1ZzSUmhug/exec",
		"KAMBUK": "https://script.google.com/macros/s/AKfycbyv5FtP_lFm4qm5hipop16-u-Hc_ItWTvNPjZEk-MhKeH0ZP82hoc48Ead61EAMNAaHvw/exec",
		"KUALA CEURAPE": "https://script.google.com/macros/s/AKfycbyOdNNvjU4idLNDSZui0XS1BVCR_y79uPxZHtRCXCRaveHzZyM_RtAG8jOvC6ezsaCp/exec",
		"LAMKUTA": "https://script.google.com/macros/s/AKfycbw00apXaB2umuAk_TBMo95Q1QO029qRRC21Hi1FREZ470MYRQBGQ0vs_QA661_BX2lo/exec",
		"LAMPOH RAYEUK": "https://script.google.com/macros/s/AKfycbw5pst_cNKlOMEZPf_eL7dA1vCJg6YvdkxW3WbR6uKtggZ_wnB2v1S3lDB8Z1TQKKs/exec",
		"LHOK BUGENG": "https://script.google.com/macros/s/AKfycbzAkWAXvPvFDfTPw0m4vmvky63D2werczxg8F2kHrl1Z-a8ZVZlbFhdF2cyxIX7qzLW/exec",
		"LINGGONG": "https://script.google.com/macros/s/AKfycbz7GVOucabSg0aG0GcVxnoPgAycZFx1zIV9Z_Jli4swSC6ZO4oEizu4U6-AUfqRjb_N/exec",
		"LUENG": "https://script.google.com/macros/s/AKfycbweuOST3dIZ7XuDyTWxvs1Xrnnh9lMDnSrhZkyECO1YQFr6fNiDJE9-tCm8dEVG6I5b/exec",
		"MEUNASAH KRUENG": "https://script.google.com/macros/s/AKfycbwrnhnlnmfOBQcD1KiqzBs_PehTGbJl92xIdEa8lpk9m7yoRI50QLQtnPKD7bZczJkxOA/exec",
		"PANTE PAKU": "https://script.google.com/macros/s/AKfycbzWqxvPXPNNE-ulkVH4UTqglgiYkeDfKC6_dVW9gNQiEOW_az2hUOisNo1Knp84rKI7/exec",
		"PANTE PEUSANGAN": "https://script.google.com/macros/s/AKfycbwLJhFlhZY9cCEEw_zR9-mRzlqgKM_ma6fcjYgEjXRyW2jhflG3Tr7yscRoF3QsPc4p/exec",
		"PANTE RANUB": "https://script.google.com/macros/s/AKfycbzt4jqXsDV7lHY-cP0jgVfe-IhpTRpdXAdGPmHGrmNaszvnH0TsRh2xCc3MYq_mGOwh/exec",
		"PANTE SUKON": "https://script.google.com/macros/s/AKfycby4ZNgkzHaSFKxfI7nGEDstDAHG504YvB6G9YA_JaFiPshyw3oAum-t0C3vvE4fIge4gg/exec",
		"PAYA BIENG": "https://script.google.com/macros/s/AKfycbyjc7RAfeotfCVQF9T7ElxB9_wCKd6lOrrHJIgdNaLJaltPceiJDvskwftQaeoLsepW/exec",
		"PULO BLANG": "https://script.google.com/macros/s/AKfycbw2LNC4gt8zqbemk_b-GlOHpOT9JTD7ASC2FwJtiTCXX1Dfdc5U7jXS6D3sKQ9-fIyJ4A/exec",
		"PULO IBOH": "https://script.google.com/macros/s/AKfycbwDbiWHrTpHWF85xAeKF8ER5UcGjtXI2l73MwMhHMGrN_oNREABEeWr3dPFnF12lrDRpA/exec",
		"PULO REUDEUP": "https://script.google.com/macros/s/AKfycbzRGfoBLaVongymkn6ZD6uQW2vceJVIqJw24arlsDnb2nEkHl08USMCvjRYEithXaYPmg/exec",
		"PULO SEUNA": "https://script.google.com/macros/s/AKfycbxfD_y2kSABLaGDjVA13ycbmy0AqLPEEif5wWfJ9DXZbzKJvILU-HTQv0a8nOycajDN/exec",
		"PULO U": "https://script.google.com/macros/s/AKfycbxupe2Fkb9xWilWK_duhVYmpHeffynRoSxl6C8k5TSBnZVNzucsZelDC6XQSUhR7KjsXA/exec",
		"PUNJOT": "https://script.google.com/macros/s/AKfycbxqsMjPSfDzE_Wvoy1-DflDQF8fvg6Wfb08EJZn2uRk3pmSfYAT9yvnvIi2LTe2eKF0rQ/exec",
		"PL. PN. MEUNASAH DUA": "https://script.google.com/macros/s/AKfycbya3Dfx-xY6kbv2V8GA2AgDYT9CzhTGicTtoBgtnU-kzmUTAQT_1qCqNAmuY4hsJk7vyQ/exec",
		"RUSEB ARA": "https://script.google.com/macros/s/AKfycbwbmTtPhHhvDam1RIgO9ScYq_gkeP5dyGAfpTPym0uSc2_cPa51jo65lr0qF6cN_mnI/exec",
		"RUSEB DAYAH": "https://script.google.com/macros/s/AKfycbybIHuMrXdsC5iMUd0wQFlJ_JbOinmsQKCGudO90-ZHXiK2LOwJQf-T1RF36Ixb4cW45Q/exec",
		"TANJUNGAN": "https://script.google.com/macros/s/AKfycbw9freKuXL29zOaWl7XEITqutbmr2r9rRjvnWaPbJaAHpMHWil2cS-w6T2ZE6R0SA4xhQ/exec",
		"TANOH ANOE": "https://script.google.com/macros/s/AKfycby2RuiU86ZEHU_m7j9FnhGciHVkg_KefcURFsVDf7TXq9zIc_IqiOlGzu7Ovjw-ZmHg/exec",
		"ULEU CEUE": "https://script.google.com/macros/s/AKfycbywXCD_7SbAU8wt1AVjpTd3JRnXdXqTaqIXSTk0jFmD72ciNG6Vm0AmnUHqsJ8niv4fUg/exec"
    };

    // Daftar kode desa
    const desaCodes = {
        "ABEUK JALOH": "2027",
        "ALUE BAYEU UTANG": "2042",
        "ALUE BIE PUSONG": "2046",
        "ALUE BUYA": "2029",
        "ALUE BUYA PASI": "2045",
        "ALUE KUTA": "2041",
        "BADA BARAT": "2016",
        "BADA TIMU": "2017",
        "BARAT LANYAN": "2009",
        "BUGAK BLANG": "2033",
        "BUGAK KRUENG": "2036",
        "BUGAK KRUENG MATE": "2035",
        "BUGAK MESJID": "2034",
        "BUGENG": "2040",
        "GAMPONG MEULINTEUNG": "2006",
        "GEUNDOT": "2011",
        "JANGKA ALUE": "2004",
        "JANGKA ALUE BIE": "2005",
        "JANGKA ALUE U": "2003",
        "JANGKA KEUTAPANG": "2002",
        "JANGKA MESJID": "2001",
        "KAMBUK": "2013",
        "KUALA CEURAPE": "2044",
        "LAMKUTA": "2010",
        "LAMPOH RAYEUK": "2021",
        "LHOK BUGENG": "2020",
        "LINGGONG": "2024",
        "LUENG": "2012",
        "MEUNASAH KRUENG": "2008",
        "PANTE PAKU": "2032",
        "PANTE PEUSANGAN": "2030",
        "PANTE RANUB": "2037",
        "PANTE SUKON": "2031",
        "PAYA BIENG": "2007",
        "PULO BLANG": "2025",
        "PULO IBOH": "2026",
        "PULO REUDEUP": "2022",
        "PULO SEUNA": "2023",
        "PULO U": "2028",
        "PUNJOT": "2039",
        "PL. PN. MEUNASAH DUA": "2038",
        "RUSEB ARA": "2014",
        "RUSEB DAYAH": "2015",
        "TANJUNGAN": "2018",
        "TANOH ANOE": "2019",
        "ULEU CEUE": "2043"
    };

    // Inisialisasi flatpickr untuk input tanggal lahir

	

    // Debugging untuk tombol
    document.addEventListener('DOMContentLoaded', () => {
        console.log('DOM loaded');
        document.getElementById('btn-add').addEventListener('click', () => console.log('Add button clicked'));
        document.getElementById('btn-edit').addEventListener('click', () => console.log('Edit button clicked'));
        document.getElementById('btn-delete').addEventListener('click', () => console.log('Delete button clicked'));
    });

    // Fungsi untuk memanggil API berdasarkan pilihan combobox
    function executeFunction() {
        console.log('executeFunction called');
        const selectedDesa = document.getElementById("functionSelect").value;
        if (!selectedDesa) {
            alert("Silakan pilih desa terlebih dahulu!");
            return;
        }
        const url = getDesaUrl(selectedDesa);
        if (url && !url.includes("PLACEHOLDER_URL")) {
            fetchDataFromUrl(url);
        } else {
            alert("URL untuk desa ini belum tersedia. Silakan hubungi admin.");
        }
    }

    async function fetchDataFromUrl(url) {
        console.log('fetchDataFromUrl called with URL:', url);
        document.getElementById('progress').style.display = 'block';
        const progressBar = document.getElementById('progress-bar');
        progressBar.style.width = '0%';

        let progress = 0;
        const interval = setInterval(() => {
            progress += 1;
            progressBar.style.width = progress + '%';
            if (progress >= 100) clearInterval(interval);
        }, 10);

        try {
            let response = await fetch(url);
            console.log('Fetch response status:', response.status);
            if (!response.ok) {
                console.warn(`HTTP error! Status: ${response.status}. Trying no-cors mode.`);
                response = await fetch(url, { mode: 'no-cors' });
                data = JSON.parse(localStorage.getItem('pendudukData')) || [];
                if (data.length === 0) {
                    throw new Error('No data in localStorage and no-cors mode used');
                }
            } else {
                data = await response.json();
                data = data.data || data;
                localStorage.setItem('pendudukData', JSON.stringify(data));
            }
            filteredData = data;
            console.log('Data fetched:', data);
            displayData();
        } catch (error) {
            console.error('Error fetching data:', error);
            data = JSON.parse(localStorage.getItem('pendudukData')) || [];
            filteredData = data;
            if (data.length > 0) {
                alert('Gagal memuat data dari server, menampilkan data lokal.');
                displayData();
            } else {
                alert(`Gagal memuat data dari server: ${error.message}. Silakan coba lagi.`);
            }
        } finally {
            clearInterval(interval);
            document.getElementById('progress').style.display = 'none';
        }

        document.getElementById('search').value = '';
        document.getElementById('search').focus();
    }

    function displayData() {
        console.log('displayData called');
        const tbody = document.getElementById('data-body');
        tbody.innerHTML = '';
        const startIndex = (currentPage - 1) * rowsPerPage;
        const endIndex = Math.min(startIndex + rowsPerPage, filteredData.length);

        if (filteredData.length === 0) {
            tbody.innerHTML = '<tr><td colspan="12">Tidak ada data tersedia.</td></tr>';
        }

        for (let i = startIndex; i < endIndex; i++) {
            const item = filteredData[i];
            const row = `<tr onclick="selectRow(this)">
                <td>${item.kode || ''}</td>
                <td>${item.kk || ''}</td>
                <td>${item.nik || ''}</td>
                <td>${item.nama || ''}</td>
                <td>${item.tempatLahir || item.tempatlahir || ''}</td>
                <td>${formatDate(item.tglLahir || item.tgllahir) || ''}</td>
                <td>${item.status || ''}</td>
                <td>${item.jenisKelamin || item.jeniskelamin || ''}</td>
                <td>${item.pekerjaan || ''}</td>
                <td>${item.alamatDusun || item.alamatdusun || ''}</td>
                <td>${item.desa || ''}</td>
                <td></td> <!-- Sel Aksi tetap ada, tapi kosong dan disembunyikan -->
            </tr>`;
            tbody.innerHTML += row;
        }

        setupPagination();
    }

    function selectRow(row) {
        console.log('selectRow called');
        const allRows = document.querySelectorAll('#data-body tr');
        allRows.forEach(r => r.classList.remove('selected'));
        row.classList.add('selected');
        // Ambil hanya 11 kolom yang terlihat (abaikan kolom Aksi)
        selectedRowData = Array.from(row.children).slice(0, 11).map(cell => cell.textContent);
        console.log('selectedRowData:', selectedRowData);
    }

    function setupPagination() {
        console.log('setupPagination called');
        const pagination = document.getElementById('page-numbers');
        pagination.innerHTML = '';
        const pageCount = Math.ceil(filteredData.length / rowsPerPage);

        const startPage = Math.max(1, currentPage - 2);
        const endPage = Math.min(pageCount, startPage + 4);

        for (let i = startPage; i <= endPage; i++) {
            const pageButton = document.createElement('button');
            pageButton.innerText = i;
            pageButton.onclick = () => changePage(i);
            if (i === currentPage) pageButton.style.backgroundColor = '#ddd';
            pagination.appendChild(pageButton);
        }
    }

    function changePage(direction) {
        console.log('changePage called with direction:', direction);
        const pageCount = Math.ceil(filteredData.length / rowsPerPage);

        if (direction === 'prev' && currentPage > 1) {
            currentPage--;
        } else if (direction === 'next' && currentPage < pageCount) {
            currentPage++;
        } else if (typeof direction === 'number') {
            currentPage = direction;
        }

        displayData();
    }

    document.getElementById('search').addEventListener('input', function () {
        console.log('Search input:', this.value);
        const searchTerm = this.value.toLowerCase();
        filteredData = data.filter(item => item.nama.toLowerCase().includes(searchTerm));
        currentPage = 1;
        displayData();
    });

const searchInput = document.getElementById('search');
const clearButton = document.getElementById('clear-search');

searchInput.addEventListener('input', function () {
    if (this.value.length > 0) {
        clearButton.style.display = 'block';
    } else {
        clearButton.style.display = 'none';
    }
});

clearButton.addEventListener('click', function () {
		console.log('Clear button clicked');
        searchInput.value = '';
        clearButton.style.display = 'none';
        filteredData = data;
        currentPage = 1;
        displayData();
        searchInput.focus(); // Aktifkan kursor di kotak pencarian
});






    function toggleForm(isEdit = false) {
    console.log('toggleForm called');
    const formPopup = document.getElementById('form-popup');
    const popupHeader = document.getElementById('popup-header');
    const isVisible = formPopup.style.display === 'block';

    if (isVisible) {
        formPopup.style.display = 'none';
        isEditMode = false;
        clearForm();
    } else {
        const selectedDesa = document.getElementById("functionSelect").value;
        if (!selectedDesa) {
            alert("Silakan pilih desa terlebih dahulu!");
            return;
        }
        document.getElementById("desa").value = toTitleCase(selectedDesa);
        isEditMode = isEdit;
        popupHeader.textContent = isEdit ? " üìù EDIT DATA PENDUDUK " : " ‚úÖ TAMBAH DATA PENDUDUK";
        formPopup.style.display = 'block';
    }
}



    function clearForm() {
        console.log('clearForm called');
        document.getElementById("kk").value = '';
        document.getElementById("nik").value = '';
        document.getElementById("nama").value = '';
        document.getElementById("tempatlahir").value = '';
        document.getElementById("tgllahir").value = '';
        document.getElementById("status").value = '';
        document.getElementById("jeniskelamin").value = '';
        document.getElementById("pekerjaan").value = '';
        document.getElementById("alamatdusun").value = '';
        document.getElementById("desa").value = '';
    }

    function goBack() {
    window.location.href = 'index.html'; // ganti sesuai halaman yang kamu maksud
}

    function formatDate(dateString) {
        try {
            const options = { day: '2-digit', month: '2-digit', year: 'numeric' };
            return new Date(dateString).toLocaleDateString('id-ID', options);
        } catch (error) {
            console.error('Error formatting date:', dateString, error);
            return dateString;
        }
    }

    function showSelectedData() {
        console.log('showSelectedData called');
        if (!selectedRowData) {
            showSuccessMessage("‚ùå Silakan pilih salah satu keluarga untuk Prosess");
            return;
        }

        const selectedKK = selectedRowData[1];
        const relatedData = data.filter(item => item.kk === selectedKK);

        try {
            localStorage.setItem('selectedPendudukData', JSON.stringify(relatedData));
            console.log('Data saved to localStorage:', relatedData);
            window.location.href = 'menu_surat.html';
            const selectedFunction = document.getElementById("functionSelect").value;
            localStorage.setItem("selectedFunction", selectedFunction);
        } catch (error) {
            console.error('Error saving to localStorage:', error);
            showSuccessMessage("‚ùå Gagal menyimpan data ke localStorage. Silakan coba lagi.");
        }
    }


function toTitleCase(str) {
  return str.toLowerCase().split(' ').map(function(word) {
    return word.charAt(0).toUpperCase() + word.slice(1);
  }).join(' ');
}


    function validateForm() {
    // Ambil elemen input
    const kk = document.getElementById("kk");
    const nik = document.getElementById("nik");
    const status = document.getElementById("status");
    const gender = document.getElementById("jeniskelamin");
	const tglLahir = document.getElementById("tgllahir");

    // Ambil elemen error message
    const kkError = document.getElementById("kk-error");
    const nikError = document.getElementById("nik-error");
    const statusError = document.getElementById("status-error");
    const genderError = document.getElementById("gender-error");
	const tglError = document.getElementById("tgl-error");

    // Reset error
    [kkError, nikError, tglError, statusError, genderError].forEach(e => e.textContent = '');
    [kk, nik, tglLahir, status, gender].forEach(f => f.classList.remove('error'));


    let isValid = true;

    if (!/^\d{16}$/.test(kk.value.trim())) {
        kkError.textContent = "Nomor KK harus 16 digit angka!";
        kk.classList.add("error");
        isValid = false;
    }

    if (!/^\d{16}$/.test(nik.value.trim())) {
        nikError.textContent = "NIK harus 16 digit angka!";
        nik.classList.add("error");
        isValid = false;
    }

    if (!/^[PSB]$/i.test(status.value.trim())) {
        statusError.textContent = "Hanya boleh :  B, S dan P";
        status.classList.add("error");
        isValid = false;
    }

    if (!/^[LP]$/i.test(gender.value.trim())) {
        genderError.textContent = "Hanya boleh : L dan P";
        gender.classList.add("error");
        isValid = false;
    }
	
	if (!/^\d{2}\/\d{2}\/\d{4}$/.test(tglLahir.value.trim())) {
    tglError.textContent = "Gunakan format tanggal DD/MM/YYYY.";
    tglLahir.classList.add("error");
    isValid = false;
}


    return isValid;
}


    function addData() {
        console.log('addData called');
        if (!validateForm()) {
            showSuccessMessage("‚ùå Periksa input yang salah!");
            return;
        }

        const desaTerpilih = document.getElementById("functionSelect").value;
        const scriptURL = scriptURLs[desaTerpilih];

        if (!scriptURL || scriptURL.includes("PLACEHOLDER_URL")) {
            showSuccessMessage("‚ùå URL untuk desa ini belum tersedia. Silakan hubungi admin.");
            return;
        }

        const kodeDesa = desaCodes[desaTerpilih];
        if (!kodeDesa) {
            showSuccessMessage("‚ùå Kode desa untuk " + desaTerpilih + " tidak ditemukan. Silakan hubungi admin.");
            return;
        }

        const dataPenduduk = {
            kode: kodeDesa,
            kk: document.getElementById("kk").value.trim(),
            nik: document.getElementById("nik").value.trim(),
            nama: document.getElementById("nama").value.trim(),
            tempatLahir: document.getElementById("tempatlahir").value.trim(),
            tglLahir: document.getElementById("tgllahir").value.trim(),
            status: document.getElementById("status").value.trim().toUpperCase(),
            jenisKelamin: document.getElementById("jeniskelamin").value.trim().toUpperCase(),
            pekerjaan: document.getElementById("pekerjaan").value.trim(),
            alamatDusun: document.getElementById("alamatdusun").value.trim(),
            desa: document.getElementById("desa").value.trim()
        };

        toggleForm();
        showMiniLoading(true);

        fetch(scriptURL, {
            method: "POST",
            mode: "no-cors",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(dataPenduduk)
        })
        .then(() => {
            data.push(dataPenduduk);
            localStorage.setItem('pendudukData', JSON.stringify(data));
            executeFunction();
            showMiniLoading(false);
            showSuccessMessage("‚úÖ Data berhasil disimpan!");
        })
        .catch(error => {
            console.error("Gagal mengirim ke server:", error);
            data.push(dataPenduduk);
            localStorage.setItem('pendudukData', JSON.stringify(data));
            executeFunction();
            showMiniLoading(false);
            showSuccessMessage("‚ö†Ô∏è Data disimpan lokal (offline).");
        });
    }

    






    function editSelectedData() {
        console.log('editSelectedData called');
        if (!selectedRowData) {
            showSuccessMessage("‚ùå Silakan pilih baris terlebih dahulu.");
            return;
        }

        console.log('Filling form with selectedRowData:', selectedRowData);
        document.getElementById("kk").value = selectedRowData[1] || '';
        document.getElementById("nik").value = selectedRowData[2] || '';
        document.getElementById("nama").value = selectedRowData[3] || '';
        document.getElementById("tempatlahir").value = selectedRowData[4] || '';
        document.getElementById("tgllahir").value = selectedRowData[5] || '';
        document.getElementById("status").value = selectedRowData[6] || '';
        document.getElementById("jeniskelamin").value = selectedRowData[7] || '';
        document.getElementById("pekerjaan").value = selectedRowData[8] || '';
        document.getElementById("alamatdusun").value = selectedRowData[9] || '';
        document.getElementById("desa").value = selectedRowData[10] || '';

        toggleForm(true);
    }

   function updateData() {
        console.log('updateData called');
        if (!selectedRowData) {
            showSuccessMessage("‚ùå Silakan pilih baris terlebih dahulu.");
            return;
        }

        if (!validateForm()) {
            showSuccessMessage("‚ùå Periksa input yang salah!");
            return;
        }

        const desaTerpilih = document.getElementById("functionSelect").value;
        const scriptURL = scriptURLs[desaTerpilih];

        if (!scriptURL || scriptURL.includes("PLACEHOLDER_URL")) {
            showSuccessMessage("‚ùå URL untuk desa ini belum tersedia. Silakan hubungi admin.");
            return;
        }

        const kodeDesa = desaCodes[desaTerpilih];
        if (!kodeDesa) {
            showSuccessMessage("‚ùå Kode desa untuk " + desaTerpilih + " tidak ditemukan. Silakan hubungi admin.");
            return;
        }

        const dataPenduduk = {
            action: "edit",
            data: {
                kode: kodeDesa,
                kk: document.getElementById("kk").value.trim(),
                nik: document.getElementById("nik").value.trim(),
                nama: document.getElementById("nama").value.trim(),
                tempatLahir: document.getElementById("tempatlahir").value.trim(),
                tglLahir: document.getElementById("tgllahir").value.trim(),
                status: document.getElementById("status").value.trim().toUpperCase(),
                jenisKelamin: document.getElementById("jeniskelamin").value.trim().toUpperCase(),
                pekerjaan: document.getElementById("pekerjaan").value.trim(),
                alamatDusun: document.getElementById("alamatdusun").value.trim(),
                desa: document.getElementById("desa").value.trim()
            }
        };

        console.log('Sending edit request:', dataPenduduk);

        toggleForm();
        showMiniLoading(true);

        fetch(scriptURL, {
            method: "POST",
            mode: "no-cors",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(dataPenduduk)
        })
        .then(() => {
            const index = data.findIndex(item => item.nik === selectedRowData[2]);
            if (index !== -1) {
                data[index] = dataPenduduk.data;
                localStorage.setItem('pendudukData', JSON.stringify(data));
            } else {
                console.warn("Data tidak ditemukan di array lokal untuk NIK:", selectedRowData[2]);
            }
            selectedRowData = null;
            executeFunction();
            showMiniLoading(false);
            showSuccessMessage("‚úÖ Data berhasil diperbarui!");
        })
        .catch(error => {
            console.error("Gagal update ke server:", error);
            const index = data.findIndex(item => item.nik === selectedRowData[2]);
            if (index !== -1) {
                data[index] = dataPenduduk.data;
                localStorage.setItem('pendudukData', JSON.stringify(data));
            }
            selectedRowData = null;
            executeFunction();
            showMiniLoading(false);
            showSuccessMessage("‚ö†Ô∏è Gagal update ke server, disimpan lokal.");
        });
    }





    function deleteSelectedData() {
    console.log('deleteSelectedData called');
    if (!selectedRowData) {
        showSuccessMessage("‚ùå Silakan pilih baris terlebih dahulu.");
        return;
    }

    if (!confirm("Apakah Anda yakin ingin menghapus data ini?")) return;

    const desaTerpilih = document.getElementById("functionSelect").value;
    const scriptURL = scriptURLs[desaTerpilih];

    if (!scriptURL || scriptURL.includes("PLACEHOLDER_URL")) {
        showSuccessMessage("‚ùå URL untuk desa ini belum tersedia. Silakan hubungi admin.");
        return;
    }

    const nik = selectedRowData[2]; // NIK ada di indeks 2
    const dataPenduduk = {
        action: "delete",
        nik: nik
    };

    console.log('Sending delete request:', dataPenduduk);

    // Tampilkan loading
    showMiniLoading(true);

    fetch(scriptURL, {
        method: "POST",
        mode: "no-cors",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(dataPenduduk)
    })
    .then(() => {
        data = data.filter(item => item.nik !== nik);
        localStorage.setItem('pendudukData', JSON.stringify(data));
        selectedRowData = null; // Reset setelah hapus
        executeFunction();
        showMiniLoading(false);
        showSuccessMessage("‚úÖ Data berhasil dihapus!");
    })
    .catch(error => {
        console.error("Gagal mengirim ke server:", error);
        data = data.filter(item => item.nik !== nik);
        localStorage.setItem('pendudukData', JSON.stringify(data));
        selectedRowData = null; // Reset setelah hapus
        executeFunction();
        showMiniLoading(false);
        showSuccessMessage("‚ö†Ô∏è Gagal menghapus di server, dihapus lokal.");
    });
}



// Dragging seluruh form popup
dragElement(document.getElementById("form-popup"));

function dragElement(elmnt) {
    let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;

    elmnt.onmousedown = dragMouseDown;

    function dragMouseDown(e) {
        if (e.target.tagName === "INPUT" || e.target.tagName === "BUTTON" || e.target.tagName === "SELECT" || e.target.tagName === "TEXTAREA") {
            return; // Jangan drag saat klik input/form
        }
        e.preventDefault();
        pos3 = e.clientX;
        pos4 = e.clientY;
        document.onmouseup = closeDragElement;
        document.onmousemove = elementDrag;
    }

    function elementDrag(e) {
        e.preventDefault();
        pos1 = pos3 - e.clientX;
        pos2 = pos4 - e.clientY;
        pos3 = e.clientX;
        pos4 = e.clientY;
        elmnt.style.top = (elmnt.offsetTop - pos2) + "px";
        elmnt.style.left = (elmnt.offsetLeft - pos1) + "px";
    }

    function closeDragElement() {
        document.onmouseup = null;
        document.onmousemove = null;
    }
}





    function closeDataPopup() {
        console.log('closeDataPopup called');
        document.getElementById('data-popup').style.display = 'none';
    }

    function continueToNextPage() {
    if (!selectedRowData) return alert("Pilih dulu salah satu baris data!");

    const data = {
        nama: selectedRowData["NAMA"],
        tempat_lahir: selectedRowData["TEMPAT LAHIR"],
        tgl_lahir: selectedRowData["TGL LAHIR"],
        nik: selectedRowData["NIK"],
        kk: selectedRowData["KK"]
    };

    // Kirim ke NA.html
    window.parent.postMessage(data, "*");
}

	
function showMiniLoading(show = true) {
    const miniLoading = document.getElementById('mini-loading');
    miniLoading.style.display = show ? 'block' : 'none';
}


function showSuccessMessage(message = "Berhasil!") {
        console.log('showSuccessMessage called with message:', message);
        const successDiv = document.getElementById('success-message');
        if (!successDiv) {
            console.error('Element #success-message not found!');
            return;
        }
        successDiv.textContent = message;
        successDiv.style.display = 'block';
        setTimeout(() => {
            successDiv.style.display = 'none';
        }, 5000); // Hilang otomatis dalam 2.5 detik
    }


    window.onload = function() {
        console.log('window.onload called');
        const savedFunction = localStorage.getItem("selectedFunction");
        if (savedFunction) {
            document.getElementById("functionSelect").value = savedFunction;
            executeFunction();
        }
    };
</script>
</body>
</html>
